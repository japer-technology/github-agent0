# Analysis: Files That Affect Execution â€” Agent Zero

> **Scope:** Every file in this repository that affects the runtime behavior, build process, deployment, configuration, or operational use of Agent Zero. Documentation-only files and purely informational assets are excluded unless they are loaded at runtime (e.g., knowledge base content, prompt templates).

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Entry Points & Orchestrators](#2-entry-points--orchestrators)
3. [Core Agent Framework](#3-core-agent-framework)
4. [LLM & Model Layer](#4-llm--model-layer)
5. [Agent Tools (python/tools/)](#5-agent-tools-pythontools)
6. [Prompt Templates (prompts/)](#6-prompt-templates-prompts)
7. [Helper Modules (python/helpers/)](#7-helper-modules-pythonhelpers)
8. [API Endpoints (python/api/)](#8-api-endpoints-pythonapi)
9. [WebSocket Handlers (python/websocket_handlers/)](#9-websocket-handlers-pythonwebsocket_handlers)
10. [Extensions Framework (python/extensions/)](#10-extensions-framework-pythonextensions)
11. [Agent Profiles (agents/)](#11-agent-profiles-agents)
12. [Skills System (skills/)](#12-skills-system-skills)
13. [Knowledge Base (knowledge/)](#13-knowledge-base-knowledge)
14. [Web UI (webui/)](#14-web-ui-webui)
15. [Configuration Files (conf/)](#15-configuration-files-conf)
16. [Docker & Deployment](#16-docker--deployment)
17. [GitHub Actions & Issue Intelligence](#17-github-actions--issue-intelligence)
18. [Dependency Manifests](#18-dependency-manifests)
19. [Build & Environment Files](#19-build--environment-files)
20. [Tests (tests/)](#20-tests-tests)
21. [Execution Flow Diagram](#21-execution-flow-diagram)
22. [File-by-File Reference Index](#22-file-by-file-reference-index)

---

## 1. Executive Summary

Agent Zero is a multi-agent AI framework that operates as an autonomous coding and reasoning assistant. The system comprises:

- **8 root-level Python entry points** that bootstrap, configure, and run the system
- **22 agent tools** executed during autonomous reasoning loops
- **110+ prompt templates** that define all agent behavior and personality
- **75+ REST API endpoints** for client-server communication
- **30+ helper modules** powering LLM calls, memory, shell execution, browser automation, and more
- **5 agent profiles** (agent0, default, developer, researcher, hacker)
- **A full web UI** (Flask + Uvicorn + Socket.IO) with real-time WebSocket sync
- **Docker-based deployment** with multi-stage builds, supervisord orchestration, and SearXNG integration
- **GitHub Actions workflow** for Issue Intelligence (serverless AI agent on GitHub Issues)

Every file analyzed below directly affects how Agent Zero starts, runs, responds, builds, deploys, or is configured.

---

## 2. Entry Points & Orchestrators

These are the files executed directly (via `python <file>`, Docker entrypoint, or import-time side effects) to start or prepare the system.

### `run_ui.py` â€” Primary Web Server (~560 lines)

**Role:** Main entry point. Launches Flask + Uvicorn + Socket.IO server.

**Execution effects:**
- Sets global environment: `TZ=UTC`, `TOKENIZERS_PARALLELISM=false`
- Creates Flask app with secret key (env `FLASK_SECRET_KEY` or random)
- Configures Werkzeug request limits (5GB default)
- Discovers and registers all API handlers from `python/api/`
- Discovers and registers all WebSocket namespace handlers from `python/websocket_handlers/`
- Serves static web UI files from `webui/`
- Spawns deferred background tasks: chat loading, MCP initialization, job loop, model preloading
- Initializes MCP server proxy and FastA2A server
- Applies authentication, CSRF protection, and API key validation decorators
- Starts Uvicorn ASGI server on configured host/port

**Key functions:** `run()`, `requires_auth`, `requires_api_key`, `requires_loopback`, `csrf_protect`, `login_handler()`, `serve_index()`, `configure_websocket_namespaces()`, `register_api_handler()`, `wait_for_health()`, `init_a0()`

---

### `run_tunnel.py` â€” Tunnel API Server (~60 lines)

**Role:** Lightweight Flask server for external tunnel integrations.

**Execution effects:**
- Initializes runtime and loads `.env`
- Creates Flask app with single POST endpoint proxying to `Tunnel` handler
- Suppresses request logging
- Starts WSGI server on configured tunnel port
- Registers with process manager for graceful shutdown

---

### `agent.py` â€” Core Agent Framework (~1000+ lines)

**Role:** Defines the autonomous agent execution engine. Not run directly but imported by every agent interaction.

**Execution effects:**
- Applies `nest_asyncio` globally (allows nested async event loops)
- Creates global thread locks for concurrent agent context management
- Maintains static registry of all active `AgentContext` instances

**Key classes:**
| Class | Purpose |
|-------|---------|
| `AgentContext` | Manages execution state, chat history, logging, and lifecycle of an agent session. Thread-safe static registry. |
| `Agent` | Core agent: implements `monologue()` loop (prompt â†’ LLM call â†’ tool execution â†’ repeat). |
| `AgentConfig` | Data class: model configs (chat/utility/embedding/browser), SSH settings, MCP servers, memory/knowledge paths. |
| `UserMessage` | Data class for user input (text, attachments, system message overrides). |
| `LoopData` | Per-iteration state tracker (prompts, history, tool execution). |

**Key methods:** `monologue()`, `process_tools()`, `call_chat_model()`, `handle_intervention()`, `communicate()`

---

### `initialize.py` â€” System Initialization (~178 lines)

**Role:** Bootstraps Agent Zero by loading settings, configuring models, and spawning background tasks.

**Execution effects:**
- Reads and merges settings from configuration/environment
- Creates `ModelConfig` instances for chat, utility, embedding, and browser models
- Normalizes model kwargs (string â†’ numeric type conversion)
- Triggers data migration (`migration.py`) if needed
- Reloads `.env` and re-parses settings after migration
- Spawns deferred async tasks: MCP init, chat loading, job loop, model preloading

**Key functions:** `initialize_agent()`, `initialize_chats()`, `initialize_mcp()`, `initialize_job_loop()`, `initialize_preload()`, `initialize_migration()`, `_normalize_model_kwargs()`, `_args_override()`, `_set_runtime_config()`

---

### `models.py` â€” LLM Model Abstraction (~930 lines)

**Role:** Wraps LiteLLM + LangChain for multi-provider LLM support with streaming, rate limiting, and retry logic.

**Execution effects:**
- Disables LiteLLM logging globally on import
- Sets `litellm.modify_params = True` for Anthropic compatibility
- Applies `browser_use_monkeypatch` for browser model fixes
- Creates global rate limiter and API key rotation dictionaries
- Dynamically loads sentence-transformer models on demand

**Key classes:**
| Class | Purpose |
|-------|---------|
| `ModelConfig` | Provider, name, API base, context length, rate limits, vision capability, kwargs. |
| `ChatGenerationResult` | Accumulates streaming chunks; separates reasoning from response; parses `<think>`/`<reasoning>` tags. |
| `LiteLLMChatWrapper` | LangChain chat model using LiteLLM backend. Streaming, rate limiting, message conversion, tool calls. |
| `BrowserCompatibleChatWrapper` | Extended wrapper for browser automation; Gemini JSON fixes. |
| `LiteLLMEmbeddingWrapper` | LangChain Embeddings via LiteLLM for remote APIs. |
| `LocalSentenceTransformerWrapper` | Local HuggingFace sentence-transformers (avoids API calls). |

**Key functions:** `get_chat_model()`, `get_browser_model()`, `get_embedding_model()`, `apply_rate_limiter()`, `unified_call()`

---

### `prepare.py` â€” Pre-Startup Environment (~22 lines)

**Role:** Minimal setup script executed at startup.

**Execution effects:**
- Initializes runtime
- Generates random 32-character alphanumeric root password if `ROOT_PASSWORD` env var not set
- Persists password via `settings.set_root_password()`

---

### `preload.py` â€” Model Warmup (~58 lines)

**Role:** Async preloading of ML models to reduce first-request latency.

**Execution effects:**
- Downloads and caches embedding model on first run (potentially slow)
- Optionally preloads Whisper (STT) based on settings
- Optionally preloads Kokoro (TTS) based on settings
- Runs concurrently via `asyncio.gather()`; errors are non-fatal

**Key functions:** `preload()`, `preload_embedding()`, `preload_whisper()`, `preload_kokoro()`

---

### `update_reqs.py` â€” Dependency Version Updater (~38 lines)

**Role:** Utility to rewrite `requirements.txt` with currently installed package versions.

**Execution effects:**
- Reads `requirements.txt`, queries `pkg_resources` for installed versions
- Overwrites `requirements.txt` with updated `==` version pins
- Skips comments, empty lines, and uninstalled packages

---

## 3. Core Agent Framework

The core agent loop is implemented across `agent.py`, `models.py`, and `initialize.py` (described above in Â§2). The execution cycle is:

```
User Message â†’ AgentContext.communicate()
  â†’ Agent.monologue() loop:
      1. Build system prompt (from prompts/*.md)
      2. Append conversation history
      3. Call LLM via models.unified_call() (streaming)
      4. Parse response for tool invocations
      5. Execute tools (python/tools/*.py)
      6. Append tool results to history
      7. Repeat until response.py sets break_loop=True
  â†’ Response sent to client via WebSocket
```

---

## 4. LLM & Model Layer

### `models.py`
See Â§2 above. This file is the single point of integration with all LLM providers.

### `conf/model_providers.yaml`
See Â§15. Defines available providers and their LiteLLM mappings.

### `python/helpers/providers.py`
Loads `model_providers.yaml` into a `ProviderManager` singleton. Provides `get_providers()` for UI dropdowns and `get_provider_config()` for runtime model configuration.

### `python/helpers/call_llm.py`
Unified async LLM calling with streaming. Uses `ChatPromptTemplate` + `FewShotChatMessagePromptTemplate` from LangChain. Core function: `call_llm()`.

### `python/helpers/tokens.py`
Token counting and trimming via tiktoken (`cl100k_base`). Functions: `count_tokens()`, `approximate_tokens()`, `trim_to_tokens()`. Critical for managing context window budgets.

### `python/helpers/rate_limiter.py`
Time-window rate limiter. Tracks request/token counts per key. Async-safe with cleanup. Used by `models.py` to enforce per-model rate limits.

---

## 5. Agent Tools (python/tools/)

Each tool is a Python class inheriting from `Tool` (defined in `python/helpers/tool.py`). Tools are dynamically discovered and loaded by `extract_tools.py`. The agent invokes tools during its `monologue()` loop based on LLM output.

| File | Tool | Execution Effect |
|------|------|------------------|
| `response.py` | Final Response | **Loop control:** Sets `break_loop=True` to end agent monologue. Delivers final message to user. |
| `code_execution_tool.py` | Code Execution | **Core tool:** Executes Python/Node.js/shell commands. Manages interactive sessions. 3 configurable timeout tiers. Detects prompts/dialogs. |
| `browser_agent.py` | Browser Agent | Controls browser-use library for autonomous web browsing. 5-minute timeout. Vision-capable. Manages browser sessions. |
| `search_engine.py` | Web Search | Queries SearXNG for real-time web search results. |
| `document_query.py` | Document QA | Answers questions over documents (PDF, HTML, text, images). Handles file/HTTP URIs. |
| `memory_save.py` | Memory Save | Persists text to agent's FAISS memory database with metadata. |
| `memory_load.py` | Memory Load | Queries memory by semantic similarity threshold. Retrieves past context. |
| `memory_forget.py` | Memory Forget | Deletes memories matching a query (soft forget). |
| `memory_delete.py` | Memory Delete | Hard-deletes specific memories by ID. |
| `call_subordinate.py` | Subordinate Agent | Creates/delegates to subordinate agents. Compresses subordinate history. |
| `skills_tool.py` | Skills | Lists/loads SKILL.md files. Max 5 active skills at once. Semantic trigger-based. |
| `behaviour_adjustment.py` | Behavior Adjustment | Merges user adjustments into custom behavior rules via LLM. Dynamic ruleset modification. |
| `scheduler.py` | Task Scheduler | Creates/manages recurring (CRON), one-time, and multi-step scheduled tasks. |
| `notify_user.py` | Notification | Sends notifications to UI with type, priority, and timeout. |
| `a2a_chat.py` | Agent-to-Agent | Communicates with FastA2A-compatible remote agents. Cross-instance delegation. |
| `vision_load.py` | Vision Processing | Compresses/encodes images to base64 for vision models. Max 768K pixels, 75% JPEG quality. ~1500 token estimate. |
| `input.py` | Keyboard Input | Forwards keyboard input to code execution tool's active session. |
| `wait.py` | Wait/Delay | Delays until duration or timestamp. Supports pause intervention. |
| `unknown.py` | Fallback | Error handler for undefined tool calls. Returns available tools list. |

**Tool base class:** `python/helpers/tool.py` â€” Defines `Tool` abstract class with `before_execution()`, `execute()` (abstract), `after_execution()` lifecycle. Includes `Response` dataclass with `message`, `break_loop`, and metadata fields.

**Tool discovery:** `python/helpers/extract_tools.py` â€” `load_classes_from_folder()` dynamically discovers `Tool` subclasses. Also provides `json_parse_dirty()` for lenient parsing of LLM JSON output.

---

## 6. Prompt Templates (prompts/)

**110+ Markdown files** that define all agent behavior, personality, tool descriptions, error messages, and framework responses. These are loaded at runtime via `agent.read_prompt("filename.md", **kwargs)` with variable substitution (`{param}` placeholders).

**Without these files, the agent cannot function.** They constitute the behavioral specification layer.

### System Prompts (agent.system.*)

| File | Controls |
|------|----------|
| `agent.system.main.md` | Core system prompt: identity, capabilities, behavioral rules |
| `agent.system.main.role.md` | Role definition and persona |
| `agent.system.behaviour.md` | Behavioral guidelines and custom rules |
| `agent.system.tools.md` | Available tools listing and usage instructions |
| `agent.system.tool.response.md` | Response tool format and instructions |
| `agent.system.tool.code_exe.md` | Code execution tool documentation |
| `agent.system.tool.browser_agent.md` | Browser agent tool documentation |
| `agent.system.tool.memory.md` | Memory tools (save/load/forget/delete) documentation |
| `agent.system.tool.search_engine.md` | Search engine tool documentation |
| `agent.system.tool.document_query.md` | Document query tool documentation |
| `agent.system.tool.call_subordinate.md` | Subordinate agent delegation documentation |
| `agent.system.tool.skills.md` | Skills tool documentation |
| `agent.system.tool.behaviour_adjustment.md` | Behavior adjustment tool documentation |
| `agent.system.tool.scheduler.md` | Scheduler tool documentation |
| `agent.system.tool.notify_user.md` | Notification tool documentation |
| `agent.system.tool.a2a_chat.md` | Agent-to-agent chat documentation |
| `agent.system.tool.vision_load.md` | Vision processing tool documentation |
| `agent.system.tool.wait.md` | Wait/delay tool documentation |
| `agent.system.tool.input.md` | Keyboard input tool documentation |
| `agent.system.memories.md` | Memory system behavior and search patterns |
| `agent.system.skills.md` | Skills system behavior |
| `agent.system.mcp_tools.md` | MCP (Model Context Protocol) tool integration |
| `agent.system.projects.md` | Project workspace management |
| `agent.system.secrets.md` | Secrets and variables management |
| `agent.system.datetime.md` | Date/time awareness and formatting |

### Framework Messages (fw.*)

These control how tool results, errors, and system events are formatted and presented to the LLM:

| Category | Examples | Purpose |
|----------|----------|---------|
| Tool Results | `fw.tool_result.md`, `fw.tool_response.md` | Formats tool output for LLM context |
| Code Execution | `fw.code_exe_result.md`, `fw.code_exe_timeout.md` | Code execution feedback formatting |
| Errors | `fw.error.md`, `fw.error_tool.md`, `fw.msg_timeout.md` | Error message templates |
| Memory Events | `fw.memories_board.md`, `fw.memories_board_solution.md` | Memory recall formatting |
| Interventions | `fw.intervention.md`, `fw.intervention_msg.md` | User interruption handling |
| Messages | `fw.msg_misformat.md`, `fw.msg_repeat.md`, `fw.msg_nothing.md` | Edge case message handling |
| Subordinates | `fw.subordinate_summary.md`, `fw.subordinate_result.md` | Sub-agent communication formatting |
| Skills | `fw.skills_response.md`, `fw.skills_info.md` | Skill loading/execution formatting |

### Memory Prompts (memory.*)

| File | Purpose |
|------|---------|
| `memory.consolidation.*.md` | Memory compression and summarization instructions |
| `memory.filter.md` | Memory relevance filtering |
| `memory.query_visual.md` | Visual memory query formatting |
| `memory.keywords_visual.md` | Keyword extraction for memory search |
| `memory.solution.md` | Solution memory storage patterns |

### Behavior Prompts (behaviour.*)

| File | Purpose |
|------|---------|
| `behaviour.search.md` | Behavior search patterns |
| `behaviour.merge.md` | Behavior rule merging instructions |
| `behaviour.update.md` | Behavior update procedures |

### Special Prompts

| File | Purpose |
|------|---------|
| `browser_agent.system.md` | Complete browser automation system prompt |
| `agent.context.extras.md` | Additional context injection |
| `agent.extras.info.md` | Agent metadata template |
| `agent.extras.workdir_structure.md` | Working directory structure description |

---

## 7. Helper Modules (python/helpers/)

These are the shared utility modules that power all execution. Every module listed below is imported and used at runtime.

### Core Infrastructure

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `runtime.py` | Runtime environment detection, CLI argument parsing, dev/production mode switching | `initialize()`, `is_dockerized()`, `is_development()`, `get_local_url()`, `get_runtime_id()` |
| `settings.py` | Central configuration management (TypedDict). All agent behavior flows through settings. Env vars `A0_SET_*` override defaults. | Settings TypedDict, `get_settings()`, `set_root_password()` |
| `dotenv.py` | `.env` file persistence (`usr/.env`). Handles AUTH_LOGIN, AUTH_PASSWORD, RFC_PASSWORD, ROOT_PASSWORD. | `load_dotenv()`, `get_dotenv_value()`, `save_dotenv_value()` |
| `files.py` | File/directory operations, template parsing with variable substitution, includes processing, binary/text detection. | `parse_file()`, `read_prompt_file()`, path normalization |
| `log.py` | Structured logging with secret masking, truncation, and state monitor integration. Drives UI updates. | `LogItem`, `Log`, `mark_dirty_all`, `mark_dirty_for_context` |
| `errors.py` | Error formatting with context trimming. `RepairableException` for LLM self-repair. | `format_error()`, `handle_error()`, `RepairableException` |
| `process.py` | Server lifecycle: shutdown, reload, restart. Uses `os.execv()` for restarts. | `set_server()`, `reload()`, `restart_process()`, `exit_process()` |

### LLM & AI

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `call_llm.py` | Unified async LLM calling with streaming and few-shot examples. | `call_llm()` |
| `tokens.py` | Token counting (tiktoken cl100k_base) and text trimming to token limits. | `count_tokens()`, `approximate_tokens()`, `trim_to_tokens()` |
| `providers.py` | Loads `model_providers.yaml` into `ProviderManager` singleton for UI and runtime model selection. | `ProviderManager`, `get_providers()`, `get_provider_config()` |
| `dirty_json.py` | Lenient JSON parsing (unquoted keys, single quotes, comments, trailing commas). | `DirtyJson.parse_string()`, `try_parse()` |

### Memory & Knowledge

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `memory.py` | FAISS-based vector database for semantic memory. Areas: MAIN, FRAGMENTS, SOLUTIONS. Lazy-loads per agent config. | `Memory`, `MyFaiss`, `insert_documents()`, `search_similarity_threshold()`, `delete_documents_by_query()` |
| `vector_db.py` | Lower-level FAISS wrapper with document embeddings, similarity search, and metadata filtering. | `VectorDB`, `MyFaiss` |
| `knowledge_import.py` | Knowledge file loading with change detection. Supports PDF, CSV, HTML, TXT, JSON, MD. Checksum tracking. | `load_knowledge()`, `KnowledgeImport` |
| `document_query.py` | Document Q&A with semantic search. Handles file/HTTP URIs, multiple document formats. | `DocumentQueryStore`, `DocumentQueryHelper` |
| `history.py` | Conversation history management with intelligent compression. Organizes into Topics, Bulks, and Records. Summarizes large messages. | `History`, `Topic`, `Message`, `Record` |

### Shell & Process Execution

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `shell_local.py` | Local interactive shell (bash/PowerShell) via TTY. | `LocalInteractiveSession`, `connect()`, `send_command()`, `read_output()` |
| `shell_ssh.py` | Remote SSH sessions via Paramiko. Keep-alive, UTF-8 boundary detection, ANSI escape code cleaning. 3-attempt retry. | `SSHInteractiveSession`, `connect()`, `send_command()`, `read_output()` |

### Browser Automation

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `browser.py` | Browser automation framework (currently commented out / disabled). Previous Playwright-based DOM interaction. | N/A (disabled) |
| `browser_use.py` | Minimal wrapper importing browser-use library; disables telemetry. | Import wrapper |
| `playwright.py` | Playwright binary management. Ensures headless_shell installed to `/tmp/playwright`. | `ensure_playwright_binary()` |

### Communication & Networking

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `websocket.py` | WebSocket event handling, CORS/origin validation (RFC 6455), singleton management. | `WebSocketHandler`, `validate_ws_origin()`, `WebSocketResult` |
| `websocket_manager.py` | WebSocket connection lifecycle management. | WebSocket manager singleton |
| `mcp_server.py` | Exposes Agent Zero as MCP server with SSE + HTTP streaming. Token-based security. Project URL routing. | `mcp_server` (FastMCP), `send_message()`, `finish_chat()`, `DynamicMcpProxy` |
| `mcp_handler.py` | MCP client management. Connects to local (stdio) and remote (SSE/HTTP) MCP servers. Dynamic tool discovery. | `MCPConfig`, `MCPServerLocal`, `MCPServerRemote` |
| `fasta2a_client.py` | FastA2A client for remote agent-to-agent communication. HTTP-based with Bearer token auth. | `AgentConnection`, `connect_to_agent()` |
| `fasta2a_server.py` | FastA2A server implementation for receiving agent-to-agent requests. | FastA2A server |
| `email_client.py` | IMAP/Exchange email reading. Fetches unread messages, downloads attachments, parses HTML/multipart. | `EmailClient`, `Message` |

### Security & Authentication

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `security.py` | Filename/path sanitization. Blocks path traversal, forbidden chars, Windows reserved names. | `safe_filename()`, `FORBIDDEN_CHARS_RE` |
| `crypto.py` | RSA encryption/decryption (2048-bit OAEP) and HMAC hashing. | `encrypt_data()`, `decrypt_data()`, `hash_data()`, `verify_data()` |
| `login.py` | Login credential management. | `get_credentials_hash()`, `is_login_required()` |

### Scheduling & Background

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `task_scheduler.py` | Task scheduling system with CRON, one-time, and multi-step task support. | `TaskScheduler` |
| `job_loop.py` | Background loop executing `TaskScheduler.tick()` every 60 seconds. Pauses during development mode. | `run_loop()`, `scheduler_tick()` |
| `defer.py` | Background task execution in separate event loop threads. | `DeferredTask`, `EventLoopThread` |

### Persistence & Migration

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `persist_chat.py` | Chat/context persistence. Saves/loads context JSON with agents, history, logs. | `save_tmp_chat()`, `load_tmp_chats()`, `export_json_chat()` |
| `migration.py` | Data migration from old paths to `/usr`. Moves directories/files, handles special cases. | `migrate_user_data()` |
| `backup.py` | Backup and restore system for agent data. | Backup/restore functions |

### Audio & Multimodal

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `whisper.py` | Speech-to-text via OpenAI Whisper. Preloads model, transcribes base64 audio. | `preload()`, `transcribe()` |
| `kokoro_tts.py` | Text-to-speech synthesis. Generates audio, returns base64-encoded WAV. | `preload()`, `synthesize_sentences()` |

### Search

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `duckduckgo_search.py` | Web search via DuckDuckGo with region/time filtering. | `search()` |
| `searxng.py` | Web search via SearXNG meta-search engine. | Search functions |
| `perplexity_search.py` | Web search via Perplexity API. | Search functions |

### Miscellaneous Helpers

| File | Purpose | Key Functions/Classes |
|------|---------|----------------------|
| `extension.py` | Extension loading system. Discovers and executes extensions from `python/extensions/` and `usr/extensions/`. | `call_extensions()`, `Extension` base class |
| `subagents.py` | Sub-agent configuration management. Merges definitions across default/user/project contexts. Priority: project > user > default. | `get_agents_list()`, `load_agent_data()`, `save_agent_data()` |
| `skills.py` | Skill discovery. Recursively finds `SKILL.md` files across agent/project hierarchy. YAML frontmatter parsing. | `discover_skill_md_files()`, `list_skills()`, `find_skill()`, `validate_skill()` |
| `git.py` | Git repository management. Branch/commit info, repo cloning with token auth. | `get_git_info()`, `get_repo_status()`, `clone_repo()` |
| `notification.py` | Notification system with priority/grouping. Thread-safe persistent notifications. | `NotificationManager`, `NotificationItem` |
| `localization.py` | Timezone handling with UTC offset caching. | `Localization` singleton |
| `wait.py` | Managed wait with intervention/pause support. | `managed_wait()`, `format_remaining_time()` |
| `rate_limiter.py` | Time-window rate limiting, async-safe. | `RateLimiter`, `wait()` |

---

## 8. API Endpoints (python/api/)

75+ REST API endpoint handlers. Each inherits from `ApiHandler` and implements a `process()` method. Registered dynamically by `run_ui.py`.

### Chat Management

| File | Endpoint | Purpose |
|------|----------|---------|
| `chat_create.py` | POST | Create new chat session |
| `chat_load.py` | POST | Load existing chat session |
| `chat_remove.py` | POST | Remove chat session |
| `chat_reset.py` | POST | Reset chat session state |
| `chat_export.py` | POST | Export chat to JSON |
| `chat_files_path_get.py` | GET | Get chat files directory path |
| `api_reset_chat.py` | POST | API-level chat reset |
| `api_terminate_chat.py` | POST | Terminate active chat |

### Messaging

| File | Endpoint | Purpose |
|------|----------|---------|
| `message.py` | POST | Primary chat message endpoint |
| `message_async.py` | POST | Async message sending |
| `message_queue_add.py` | POST | Queue message for processing |
| `message_queue_remove.py` | POST | Remove queued message |
| `message_queue_send.py` | POST | Send queued messages |
| `api_message.py` | POST | External API message endpoint |

### File Operations

| File | Endpoint | Purpose |
|------|----------|---------|
| `upload.py` | POST | Upload files to agent |
| `upload_work_dir_files.py` | POST | Upload to working directory |
| `download_work_dir_file.py` | GET | Download from working directory |
| `delete_work_dir_file.py` | POST | Delete working directory file |
| `edit_work_dir_file.py` | POST | Edit working directory file |
| `get_work_dir_files.py` | GET | List working directory files |
| `rename_work_dir_file.py` | POST | Rename working directory file |
| `file_info.py` | GET | Get file metadata |

### Settings & Configuration

| File | Endpoint | Purpose |
|------|----------|---------|
| `settings_get.py` | GET | Retrieve current settings |
| `settings_set.py` | POST | Update settings |
| `settings_workdir_file_structure.py` | GET | Get working directory structure |

### Memory & Knowledge

| File | Endpoint | Purpose |
|------|----------|---------|
| `memory_dashboard.py` | GET/POST | Memory management dashboard |
| `history_get.py` | GET | Retrieve conversation history |
| `knowledge_path_get.py` | GET | Get knowledge base path |
| `knowledge_reindex.py` | POST | Reindex knowledge base |
| `import_knowledge.py` | POST | Import knowledge files |

### Scheduler

| File | Endpoint | Purpose |
|------|----------|---------|
| `scheduler_task_create.py` | POST | Create scheduled task |
| `scheduler_task_update.py` | POST | Update scheduled task |
| `scheduler_task_delete.py` | POST | Delete scheduled task |
| `scheduler_task_run.py` | POST | Manually run scheduled task |
| `scheduler_tasks_list.py` | GET | List scheduled tasks |
| `scheduler_tick.py` | POST | Trigger scheduler tick |

### Notifications

| File | Endpoint | Purpose |
|------|----------|---------|
| `notification_create.py` | POST | Create notification |
| `notifications_clear.py` | POST | Clear notifications |
| `notifications_mark_read.py` | POST | Mark notifications read |
| `notifications_history.py` | GET | Get notification history |

### MCP Server Management

| File | Endpoint | Purpose |
|------|----------|---------|
| `mcp_servers_status.py` | GET | MCP server status |
| `mcp_servers_apply.py` | POST | Apply MCP server config |
| `mcp_server_get_detail.py` | GET | Get MCP server details |
| `mcp_server_get_log.py` | GET | Get MCP server logs |

### Backup & Restore

| File | Endpoint | Purpose |
|------|----------|---------|
| `backup_create.py` | POST | Create backup |
| `backup_restore.py` | POST | Restore from backup |
| `backup_inspect.py` | GET | Inspect backup contents |
| `backup_preview_grouped.py` | GET | Preview grouped backup items |

### Audio & Media

| File | Endpoint | Purpose |
|------|----------|---------|
| `transcribe.py` | POST | Speech-to-text transcription |
| `synthesize.py` | POST | Text-to-speech synthesis |
| `image_get.py` | GET | Retrieve images |

### System & Miscellaneous

| File | Endpoint | Purpose |
|------|----------|---------|
| `health.py` | GET | Health check (no auth/CSRF) |
| `restart.py` | POST | Restart agent process |
| `pause.py` | POST | Pause agent execution |
| `poll.py` | GET | Poll for state changes |
| `csrf_token.py` | GET | Get CSRF token |
| `nudge.py` | POST | Nudge agent (wake/prompt) |
| `rfc.py` | POST | Remote function call (dev mode) |
| `tunnel.py` | POST | Tunnel proxy handler |
| `tunnel_proxy.py` | POST | Tunnel proxy routing |
| `logout.py` | POST | Logout session |
| `agents.py` | GET | List available sub-agents |
| `projects.py` | GET/POST | Project management |
| `skills.py` | GET | List available skills |
| `skills_import.py` | POST | Import skills |
| `skills_import_preview.py` | POST | Preview skill import |
| `subagents.py` | GET/POST | Sub-agent management |
| `banners.py` | GET | Get UI banners |
| `ctx_window_get.py` | GET | Get context window info |

---

## 9. WebSocket Handlers (python/websocket_handlers/)

Real-time communication handlers for Socket.IO namespaces.

| File | Namespace | Purpose |
|------|-----------|---------|
| `state_sync_handler.py` | `/state` | **Critical:** Real-time agent state synchronization to UI clients. Manages projections, sequences, full snapshots on new sync. |
| `hello_handler.py` | `/hello` | Diagnostic echo handler for connectivity testing. |
| `_default.py` | `/` | Root namespace diagnostics only. Reserved for low-risk operations. |
| `dev_websocket_test_handler.py` | `/dev_test` | Developer test harness with 8 event types (emit, request, broadcast, console). |

---

## 10. Extensions Framework (python/extensions/)

The extension system (`python/helpers/extension.py`) discovers and loads extensions from:
- `python/extensions/` â€” built-in extensions
- `usr/extensions/` â€” user-installed extensions

Extensions are Python classes inheriting from `Extension` with numeric priority ordering. They hook into agent lifecycle events (e.g., `agent_init`). The `agents/_example/extensions/` directory provides templates.

---

## 11. Agent Profiles (agents/)

Agent profiles define specialized identities with custom prompts and context. Merged at runtime: default < named agent < user overrides < project overrides.

| Directory | Title | Role |
|-----------|-------|------|
| `agents/agent0/` | Agent 0 | Root coordinator. Direct user communication, task delegation to subordinates. |
| `agents/default/` | Default | Base template. All agents inherit prompts from here unless overridden. |
| `agents/developer/` | Developer | Software development specialist. Complex dev tasks, debugging, architecture. |
| `agents/researcher/` | Researcher | Research and analysis. Information gathering, data synthesis, report generation. |
| `agents/hacker/` | Hacker | Cybersecurity expert. Penetration testing, vulnerability analysis, security auditing. |
| `agents/_example/` | Example | Template for creating custom agents. Includes example tools and extensions. |

**Each profile contains:**
- `agent.json` â€” Profile metadata (title, description, context)
- `_context.md` â€” Role summary and behavioral focus
- `prompts/` (optional) â€” Prompt overrides for this agent personality

---

## 12. Skills System (skills/)

Skills are modular capability files using the `SKILL.md` standard (compatible with Claude Code, Cursor, Copilot).

**Current content:**
```
skills/
â””â”€â”€ create-skill/
    â””â”€â”€ SKILL.md  (~1,200 lines)
```

**SKILL.md format:**
```yaml
---
name: "skill-name"
description: "When/why to use"
version: "1.0.0"
author: "Creator"
tags: ["category"]
trigger_patterns: ["keyword"]
---
# Skill instructions and content
```

Skills are discovered by `python/helpers/skills.py` via `discover_skill_md_files()` and loaded by the `skills_tool.py` agent tool. Maximum 5 skills active simultaneously. Trigger-based semantic activation.

**Skill search paths:** `skills/`, `usr/skills/`, project-specific skills directories.

---

## 13. Knowledge Base (knowledge/)

Runtime-loaded knowledge files indexed into FAISS vector database for semantic retrieval.

```
knowledge/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â”œâ”€â”€ installation.md   â€” Docker/OS setup instructions
â”‚   â”‚   â””â”€â”€ github_readme.md  â€” GitHub README content
â”‚   â””â”€â”€ .gitkeep
â”œâ”€â”€ solutions/
â”‚   â””â”€â”€ .gitkeep
â””â”€â”€ .gitkeep
```

**Execution impact:**
- Files in `knowledge/main/` are indexed at startup by `knowledge_import.py`
- Content is searchable via `memory.py` FAISS semantic search
- Agent can query knowledge during reasoning via memory tools
- User-populated at runtime via UI or file placement
- `knowledge/custom/` is gitignored (user-specific knowledge)

---

## 14. Web UI (webui/)

The complete frontend application served by `run_ui.py`.

### Core Files

| File | Purpose |
|------|---------|
| `index.html` | Main UI scaffold. Includes Flatpickr, KaTeX, ACE editor, FontAwesome, QR code library. |
| `index.js` | Core client logic (~2,700+ lines). Message send/receive, WebSocket sync, state management, multi-tab isolation, notifications, speech integration, file attachments. |
| `index.css` | Main stylesheet |
| `login.html` | Authentication page |
| `login.css` | Login page styles |

### Directories

| Directory | Purpose |
|-----------|---------|
| `components/` | UI components |
| `css/` | Modular stylesheets (messages, settings, modals, toasts, tables, scheduler, notifications) |
| `js/` | JavaScript modules with `manifest.json` for dynamic loading |
| `public/` | Static assets (images, icons) |
| `vendor/` | Third-party libraries (qrcode.min.js, etc.) |

### Execution Impact
- Served as static files by Flask
- `index.js` communicates with backend via REST API (`/message_async`, `/poll`) and WebSocket (`/state` namespace)
- Real-time streaming of agent responses
- Multi-project navigation, file browser, inline editor
- Mobile responsive with PWA service worker support

---

## 15. Configuration Files (conf/)

| File | Purpose | Execution Impact |
|------|---------|------------------|
| `model_providers.yaml` | 24 chat providers + 8 embedding providers mapped to LiteLLM. Env vars for API keys. | Determines available LLM backends. Loaded by `providers.py` into singleton. Controls UI model selection dropdowns. |
| `projects.default.gitignore` | Default `.gitignore` for project workspaces | Applied when creating new projects |
| `skill.default.gitignore` | Default `.gitignore` for skill directories | Applied when creating new skills |
| `workdir.gitignore` | Gitignore rules for work directories | Applied to agent working directories |

---

## 16. Docker & Deployment

### Base Image

**`docker/base/Dockerfile`** â€” Builds the foundation image (Kali Linux-based):
1. Locale/timezone setup (en_US.UTF-8, UTC)
2. System packages (~40-50 utilities in 4 layers for caching)
3. Python 3.13 + PyEnv + Python 3.12.4 with PyTorch (CPU) + uv package manager
4. SearXNG meta-search engine
5. SSH server configuration

**`docker/base/fs/`** â€” Base image filesystem overlays:

| Script | Purpose |
|--------|---------|
| `ins/install_base_packages1-4.sh` | System package installation (4 layers) |
| `ins/install_python.sh` | Python ecosystem setup |
| `ins/install_searxng.sh` | SearXNG installation |
| `ins/install_searxng2.sh` | SearXNG additional config |
| `ins/configure_ssh.sh` | SSH server setup |
| `ins/after_install.sh` | Post-install cleanup |
| `etc/searxng/` | SearXNG configuration files |

### Runtime Image

**`docker/run/Dockerfile`** â€” Production/CI runtime image:
- Requires `BRANCH` argument (enforced with error check)
- Copies `fs/` to root (installation scripts, configs)
- 4-step install pipeline: pre-install â†’ install_A0 â†’ install_additional â†’ post_install
- Cache busting with `CACHE_DATE` argument
- Exposes ports: 22 (SSH), 80 (HTTP), 9000-9009 (workers)
- Entrypoint: `initialize.sh` with supervisord

**`docker/run/docker-compose.yml`** â€” Local orchestration:
- Service `agent-zero`: maps 50080 â†’ 80, mounts `./agent-zero:/a0`
- Uses `agent0ai/agent-zero:latest` image

**`docker/run/fs/`** â€” Runtime filesystem overlays:

| Script | Category | Purpose |
|--------|----------|---------|
| `exe/initialize.sh` | Startup | Container init: copies persistent files, updates apt, starts supervisord |
| `exe/run_A0.sh` | Runtime | Sets up venv, copies A0 code, runs UI on port 80 |
| `exe/run_searxng.sh` | Service | SearXNG search engine service |
| `exe/run_tunnel_api.sh` | Service | Tunnel API service |
| `exe/node_eval.js` | Utility | JavaScript code execution engine |
| `exe/supervisor_event_listener.py` | Monitor | Supervisord event monitoring |
| `ins/pre_install.sh` | Install | Apt update, cron fixes, SSH prep |
| `ins/install_A0.sh` | Install | A0 clone/copy, pip packages, preload |
| `ins/install_A02.sh` | Install | Cache-busting install with preload |
| `ins/install_additional.sh` | Install | Extra software installation |
| `ins/post_install.sh` | Install | Cleanup (apt cache removal) |
| `ins/install_playwright.sh` | Install | Browser automation setup |
| `ins/setup_venv.sh` | Install | Python virtual environment creation |
| `ins/setup_ssh.sh` | Install | SSH daemon configuration |
| `ins/copy_A0.sh` | Install | Copies A0 code to /a0 |
| `etc/supervisor/supervisord.conf` | Config | Process manager (A0, SearXNG, tunnel) |
| `etc/nginx/nginx.conf` | Config | Reverse proxy configuration |
| `etc/searxng/` | Config | SearXNG settings |

### Local Development Image

**`DockerfileLocal`** â€” Simplified build from base:
- `BRANCH=local` (uses local files instead of GitHub clone)
- Copies `docker/run/fs/` and current directory to `/git/agent-zero`
- Same 4-step install pipeline
- Same port exposure and entrypoint

---

## 17. GitHub Actions & Issue Intelligence

### Workflow

**`.github/workflows/ISSUE-INTELLIGENCE-WORKFLOW-AGENT.yml`**

**Triggers:** Issue opened, issue comment created (excluding bot comments)

**Authorization:** Requires admin/maintain/write permissions

**Steps:**
1. Guard check: validates `.issue-intelligence/ISSUE-INTELLIGENCE-ENABLED.md` exists
2. Pre-install status indicator
3. Install dependencies: `bun install` in `.issue-intelligence/`
4. Run TypeScript agent to analyze and respond to issues

**Secrets:** `ANTHROPIC_API_KEY`, `GITHUB_TOKEN`

### Issue Intelligence System (`.issue-intelligence/`)

A complete serverless AI agent running on GitHub Actions/Issues.

| File/Directory | Purpose |
|---------------|---------|
| `.pi/settings.json` | LLM provider/model configuration |
| `.pi/APPEND_SYSTEM.md` | System prompt additions |
| `.pi/BOOTSTRAP.md` | Initialization guide |
| `.pi/skills/` | Modular skill files |
| `lifecycle/ISSUE-INTELLIGENCE-AGENT.ts` | Main orchestrator |
| `lifecycle/ISSUE-INTELLIGENCE-INDICATOR.ts` | ðŸ‘€ status reaction management |
| `lifecycle/ISSUE-INTELLIGENCE-ENABLED.ts` | Fail-closed guard logic |
| `install/ISSUE-INTELLIGENCE-INSTALLER.ts` | Bootstrap script |
| `install/ISSUE-INTELLIGENCE-WORKFLOW-AGENT.yml` | Actions template |
| `state/issues/` | Issue # â†’ session mapping |
| `state/sessions/` | JSONL conversation logs |
| `ISSUE-INTELLIGENCE-ENABLED.md` | Kill switch (delete to disable) |
| `ISSUE-INTELLIGENCE-INSTALLED.md` | Installation status marker |
| `ISSUE-INTELLIGENCE-QUICKSTART.md` | Setup guide |
| `package.json` | Node.js/Bun dependencies |
| `bun.lock` | Dependency lock file |

**Architecture:** Each GitHub issue = AI chat session with persistent memory. Comments trigger agent responses. Full conversation history committed to git for audit trail.

---

## 18. Dependency Manifests

| File | Purpose | Execution Impact |
|------|---------|------------------|
| `requirements.txt` | 50+ Python runtime dependencies | Defines core runtime. Missing packages = runtime errors. Key: LangChain, LiteLLM, Playwright, Whisper, Kokoro, FastMCP, Flask, FAISS, sentence-transformers, browser-use, Docker SDK, GitPython, boto3 |
| `requirements.dev.txt` | Test framework (pytest, pytest-asyncio, pytest-mock) | Dev-only. Enables local testing. |
| `requirements2.txt` | Version overrides (litellm, openai) | Resolves dependency conflicts for critical packages. |
| `.issue-intelligence/package.json` | Node.js/Bun dependencies for Issue Intelligence | Powers the GitHub Actions agent. |
| `.issue-intelligence/bun.lock` | Bun lock file | Ensures deterministic dependency resolution. |

---

## 19. Build & Environment Files

| File | Purpose | Execution Impact |
|------|---------|------------------|
| `.gitignore` | Excludes: `__pycache__/`, `.venv/`, `memory/`, `knowledge/custom/`, `logs/`, `tmp/`, `usr/`, `.env` | Prevents committing secrets, build artifacts, user data. Preserves directory structure via `.gitkeep`. |
| `.dockerignore` | Excludes: `.git/`, `memory/`, `instruments/`, `tmp/`, `logs/`, test files, `.venv/` | Reduces Docker build context. Faster image builds. |
| `.gitattributes` | Git line ending and binary file handling | Ensures consistent file handling across platforms. |
| `jsconfig.json` | JavaScript path resolution: `baseUrl: "."`, paths map `*` â†’ `webui/*` | Enables shorter import paths in web UI code. |
| `.vscode/` | VS Code workspace settings | Development environment configuration. |

---

## 20. Tests (tests/)

28 test files validating runtime behavior. Tests exercise execution-affecting code paths.

### WebSocket Infrastructure (10 files)

| File | Tests |
|------|-------|
| `test_websocket_namespace_discovery.py` | Namespace auto-discovery from file system |
| `test_websocket_security.py` | Origin validation, CSRF protection |
| `test_websocket_handler_registry.py` | Handler registration and deduplication |
| `test_websocket_handler_api.py` | Handler class API surface |
| `test_websocket_namespaces_integration.py` | End-to-end namespace integration |
| `test_socketio_auth_csrf.py` | Socket.IO authentication and CSRF |
| `test_socketio_client_api.py` | Socket.IO client interface |
| `test_socketio_handler_discovery.py` | Socket.IO handler discovery |
| `test_socketio_welcome_screen.py` | Welcome screen WebSocket events |
| `websocket_namespace_test_utils.py` | Shared test utilities |

### State Synchronization (4 files)

| File | Tests |
|------|-------|
| `test_state_sync_welcome_screen.py` | Welcome screen state sync |
| `test_state_sync_log_persistence.py` | Log persistence across syncs |
| `test_state_monitor.py` | State change monitoring |
| `test_multi_tab_isolation.py` | Chat isolation between browser tabs |

### Snapshot & Serialization (3 files)

| File | Tests |
|------|-------|
| `test_snapshot_schema_v1.py` | Snapshot schema version 1 validation |
| `test_snapshot_parity.py` | Parity between snapshot formats |
| `test_snapshot_schema_v1_detail.py` | Detailed schema v1 validation |

### Other Tests

| File | Tests |
|------|-------|
| `test_http_auth_csrf.py` | HTTP authentication and CSRF protection |
| `test_persist_chat_log_ids.py` | Chat ID preservation across persistence |
| `test_run_ui_config.py` | UI configuration settings |
| `test_file_tree_visualize.py` | Directory tree visualization |
| `test_fasta2a_client.py` | Agent-to-agent protocol |
| `test_settings_developer_sections.py` | Developer settings UI sections |
| `email_parser_test.py` | Email parsing |
| `chunk_parser_test.py` | Chunk parsing |
| `rate_limiter_test.py` | Rate limiter behavior |

---

## 21. Execution Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CONTAINER STARTUP                            â”‚
â”‚                                                                     â”‚
â”‚  docker/base/Dockerfile â†’ Base image (Kali + Python + SearXNG)      â”‚
â”‚  docker/run/Dockerfile  â†’ Runtime image (A0 code + dependencies)    â”‚
â”‚  DockerfileLocal        â†’ Local dev image                           â”‚
â”‚                                                                     â”‚
â”‚  exe/initialize.sh â†’ supervisord                                    â”‚
â”‚    â”œâ”€â”€ exe/run_A0.sh         â†’ run_ui.py (port 80)                  â”‚
â”‚    â”œâ”€â”€ exe/run_searxng.sh    â†’ SearXNG (search engine)              â”‚
â”‚    â””â”€â”€ exe/run_tunnel_api.sh â†’ run_tunnel.py (tunnel API)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SERVER STARTUP                               â”‚
â”‚                                                                     â”‚
â”‚  prepare.py â†’ Runtime init, SSH password generation                 â”‚
â”‚  run_ui.py  â†’ Flask + Uvicorn + Socket.IO server                    â”‚
â”‚    â”œâ”€â”€ initialize.py â†’ Load settings, create ModelConfigs           â”‚
â”‚    â”‚   â”œâ”€â”€ models.py â†’ Configure LLM providers (LiteLLM)            â”‚
â”‚    â”‚   â”œâ”€â”€ conf/model_providers.yaml â†’ Provider registry             â”‚
â”‚    â”‚   â””â”€â”€ Deferred tasks:                                          â”‚
â”‚    â”‚       â”œâ”€â”€ preload.py â†’ Warm embedding/Whisper/Kokoro models    â”‚
â”‚    â”‚       â”œâ”€â”€ mcp_handler.py â†’ Initialize MCP servers              â”‚
â”‚    â”‚       â”œâ”€â”€ persist_chat.py â†’ Load saved chats                   â”‚
â”‚    â”‚       â””â”€â”€ job_loop.py â†’ Start scheduler background loop        â”‚
â”‚    â”œâ”€â”€ Register API handlers (python/api/*.py)                      â”‚
â”‚    â”œâ”€â”€ Register WebSocket handlers (python/websocket_handlers/*.py) â”‚
â”‚    â”œâ”€â”€ Serve static UI (webui/*)                                    â”‚
â”‚    â””â”€â”€ Initialize MCP server proxy + FastA2A server                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERACTION LOOP                            â”‚
â”‚                                                                     â”‚
â”‚  Client (webui/index.js) â”€â”€HTTP POSTâ”€â”€â†’ /message_async              â”‚
â”‚  Client â†â”€â”€WebSocket /stateâ”€â”€â†’ state_sync_handler.py                â”‚
â”‚                                                                     â”‚
â”‚  API handler â†’ AgentContext.communicate()                            â”‚
â”‚    â†’ Agent.monologue() loop:                                        â”‚
â”‚        1. Build prompt (prompts/*.md via files.py)                   â”‚
â”‚        2. Load memories (memory.py â†’ FAISS vector search)           â”‚
â”‚        3. Compress history (history.py â†’ token-aware trimming)      â”‚
â”‚        4. Call LLM (models.py â†’ LiteLLM â†’ provider API)             â”‚
â”‚        5. Parse response (extract_tools.py â†’ dirty_json.py)         â”‚
â”‚        6. Execute tool (python/tools/*.py):                         â”‚
â”‚           â”œâ”€â”€ code_execution_tool.py â†’ shell_local/ssh.py           â”‚
â”‚           â”œâ”€â”€ browser_agent.py â†’ browser_use.py + playwright.py     â”‚
â”‚           â”œâ”€â”€ search_engine.py â†’ duckduckgo/searxng/perplexity      â”‚
â”‚           â”œâ”€â”€ memory_*.py â†’ memory.py â†’ vector_db.py                â”‚
â”‚           â”œâ”€â”€ call_subordinate.py â†’ recursive Agent instantiation   â”‚
â”‚           â”œâ”€â”€ skills_tool.py â†’ skills.py (SKILL.md discovery)       â”‚
â”‚           â”œâ”€â”€ scheduler.py â†’ task_scheduler.py                      â”‚
â”‚           â””â”€â”€ a2a_chat.py â†’ fasta2a_client.py                       â”‚
â”‚        7. Log results (log.py â†’ state_sync â†’ WebSocket â†’ UI)       â”‚
â”‚        8. Repeat until response.py sets break_loop=True             â”‚
â”‚                                                                     â”‚
â”‚  Agent response â†’ WebSocket broadcast â†’ Client UI update            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKGROUND SERVICES                               â”‚
â”‚                                                                     â”‚
â”‚  job_loop.py â†’ Runs task_scheduler.py.tick() every 60s              â”‚
â”‚  mcp_server.py â†’ Accepts external MCP client connections            â”‚
â”‚  fasta2a_server.py â†’ Accepts agent-to-agent requests                â”‚
â”‚  SearXNG â†’ Meta-search engine (port internal)                       â”‚
â”‚  SSH server â†’ Remote shell access (port 22)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  GITHUB ACTIONS (SEPARATE)                           â”‚
â”‚                                                                     â”‚
â”‚  .github/workflows/ISSUE-INTELLIGENCE-WORKFLOW-AGENT.yml            â”‚
â”‚    Trigger: issue opened / issue comment                            â”‚
â”‚    â†’ .issue-intelligence/lifecycle/ISSUE-INTELLIGENCE-AGENT.ts      â”‚
â”‚    â†’ Analyzes issue, posts AI response as comment                   â”‚
â”‚    â†’ Persists session to .issue-intelligence/state/                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 22. File-by-File Reference Index

Complete alphabetical index of every execution-affecting file.

### Root-Level Files

| File | Category | Section |
|------|----------|---------|
| `agent.py` | Core Framework | Â§2 |
| `DockerfileLocal` | Docker | Â§16 |
| `initialize.py` | Entry Point | Â§2 |
| `jsconfig.json` | Build Config | Â§19 |
| `models.py` | LLM Layer | Â§2, Â§4 |
| `preload.py` | Entry Point | Â§2 |
| `prepare.py` | Entry Point | Â§2 |
| `requirements.txt` | Dependencies | Â§18 |
| `requirements.dev.txt` | Dependencies | Â§18 |
| `requirements2.txt` | Dependencies | Â§18 |
| `run_tunnel.py` | Entry Point | Â§2 |
| `run_ui.py` | Entry Point | Â§2 |
| `update_reqs.py` | Utility | Â§2 |

### agents/

| File | Section |
|------|---------|
| `agents/agent0/agent.json` | Â§11 |
| `agents/agent0/_context.md` | Â§11 |
| `agents/agent0/prompts/*` | Â§11 |
| `agents/default/agent.json` | Â§11 |
| `agents/default/_context.md` | Â§11 |
| `agents/developer/agent.json` | Â§11 |
| `agents/developer/_context.md` | Â§11 |
| `agents/developer/prompts/*` | Â§11 |
| `agents/hacker/agent.json` | Â§11 |
| `agents/hacker/_context.md` | Â§11 |
| `agents/researcher/agent.json` | Â§11 |
| `agents/researcher/_context.md` | Â§11 |
| `agents/_example/*` | Â§11 |

### conf/

| File | Section |
|------|---------|
| `conf/model_providers.yaml` | Â§15 |
| `conf/projects.default.gitignore` | Â§15 |
| `conf/skill.default.gitignore` | Â§15 |
| `conf/workdir.gitignore` | Â§15 |

### docker/

| File | Section |
|------|---------|
| `docker/base/Dockerfile` | Â§16 |
| `docker/base/fs/ins/*.sh` | Â§16 |
| `docker/base/fs/etc/searxng/*` | Â§16 |
| `docker/run/Dockerfile` | Â§16 |
| `docker/run/docker-compose.yml` | Â§16 |
| `docker/run/fs/exe/initialize.sh` | Â§16 |
| `docker/run/fs/exe/run_A0.sh` | Â§16 |
| `docker/run/fs/exe/run_searxng.sh` | Â§16 |
| `docker/run/fs/exe/run_tunnel_api.sh` | Â§16 |
| `docker/run/fs/exe/node_eval.js` | Â§16 |
| `docker/run/fs/exe/supervisor_event_listener.py` | Â§16 |
| `docker/run/fs/ins/*.sh` | Â§16 |
| `docker/run/fs/etc/supervisor/supervisord.conf` | Â§16 |
| `docker/run/fs/etc/nginx/nginx.conf` | Â§16 |
| `docker/run/fs/etc/searxng/*` | Â§16 |

### .github/

| File | Section |
|------|---------|
| `.github/workflows/ISSUE-INTELLIGENCE-WORKFLOW-AGENT.yml` | Â§17 |

### .issue-intelligence/

| File | Section |
|------|---------|
| `.issue-intelligence/.pi/settings.json` | Â§17 |
| `.issue-intelligence/.pi/APPEND_SYSTEM.md` | Â§17 |
| `.issue-intelligence/.pi/BOOTSTRAP.md` | Â§17 |
| `.issue-intelligence/.pi/skills/*` | Â§17 |
| `.issue-intelligence/lifecycle/*.ts` | Â§17 |
| `.issue-intelligence/install/*` | Â§17 |
| `.issue-intelligence/state/*` | Â§17 |
| `.issue-intelligence/ISSUE-INTELLIGENCE-ENABLED.md` | Â§17 |
| `.issue-intelligence/package.json` | Â§17, Â§18 |
| `.issue-intelligence/bun.lock` | Â§17, Â§18 |

### knowledge/

| File | Section |
|------|---------|
| `knowledge/main/about/installation.md` | Â§13 |
| `knowledge/main/about/github_readme.md` | Â§13 |

### prompts/

| File | Section |
|------|---------|
| `prompts/agent.system.*.md` (25 files) | Â§6 |
| `prompts/fw.*.md` (45+ files) | Â§6 |
| `prompts/memory.*.md` (12 files) | Â§6 |
| `prompts/behaviour.*.md` (4 files) | Â§6 |
| `prompts/browser_agent.system.md` | Â§6 |
| `prompts/agent.context.extras.md` | Â§6 |
| `prompts/agent.extras.*.md` | Â§6 |

### python/api/

| File | Section |
|------|---------|
| All 75+ files in `python/api/` | Â§8 |

### python/helpers/

| File | Section |
|------|---------|
| `python/helpers/runtime.py` | Â§7 |
| `python/helpers/settings.py` | Â§7 |
| `python/helpers/dotenv.py` | Â§7 |
| `python/helpers/files.py` | Â§7 |
| `python/helpers/log.py` | Â§7 |
| `python/helpers/errors.py` | Â§7 |
| `python/helpers/process.py` | Â§7 |
| `python/helpers/call_llm.py` | Â§7 |
| `python/helpers/tokens.py` | Â§7 |
| `python/helpers/providers.py` | Â§7 |
| `python/helpers/dirty_json.py` | Â§7 |
| `python/helpers/memory.py` | Â§7 |
| `python/helpers/vector_db.py` | Â§7 |
| `python/helpers/knowledge_import.py` | Â§7 |
| `python/helpers/document_query.py` | Â§7 |
| `python/helpers/history.py` | Â§7 |
| `python/helpers/shell_local.py` | Â§7 |
| `python/helpers/shell_ssh.py` | Â§7 |
| `python/helpers/browser.py` | Â§7 |
| `python/helpers/browser_use.py` | Â§7 |
| `python/helpers/playwright.py` | Â§7 |
| `python/helpers/websocket.py` | Â§7 |
| `python/helpers/websocket_manager.py` | Â§7 |
| `python/helpers/mcp_server.py` | Â§7 |
| `python/helpers/mcp_handler.py` | Â§7 |
| `python/helpers/fasta2a_client.py` | Â§7 |
| `python/helpers/fasta2a_server.py` | Â§7 |
| `python/helpers/email_client.py` | Â§7 |
| `python/helpers/security.py` | Â§7 |
| `python/helpers/crypto.py` | Â§7 |
| `python/helpers/login.py` | Â§7 |
| `python/helpers/task_scheduler.py` | Â§7 |
| `python/helpers/job_loop.py` | Â§7 |
| `python/helpers/defer.py` | Â§7 |
| `python/helpers/extension.py` | Â§7 |
| `python/helpers/subagents.py` | Â§7 |
| `python/helpers/skills.py` | Â§7 |
| `python/helpers/git.py` | Â§7 |
| `python/helpers/notification.py` | Â§7 |
| `python/helpers/localization.py` | Â§7 |
| `python/helpers/wait.py` | Â§7 |
| `python/helpers/rate_limiter.py` | Â§7 |
| `python/helpers/persist_chat.py` | Â§7 |
| `python/helpers/migration.py` | Â§7 |
| `python/helpers/backup.py` | Â§7 |
| `python/helpers/whisper.py` | Â§7 |
| `python/helpers/kokoro_tts.py` | Â§7 |
| `python/helpers/duckduckgo_search.py` | Â§7 |
| `python/helpers/searxng.py` | Â§7 |
| `python/helpers/perplexity_search.py` | Â§7 |

### python/tools/

| File | Section |
|------|---------|
| All 22 files in `python/tools/` | Â§5 |

### python/websocket_handlers/

| File | Section |
|------|---------|
| `python/websocket_handlers/state_sync_handler.py` | Â§9 |
| `python/websocket_handlers/hello_handler.py` | Â§9 |
| `python/websocket_handlers/_default.py` | Â§9 |
| `python/websocket_handlers/dev_websocket_test_handler.py` | Â§9 |

### skills/

| File | Section |
|------|---------|
| `skills/create-skill/SKILL.md` | Â§12 |

### tests/

| File | Section |
|------|---------|
| All 28 files in `tests/` | Â§20 |

### webui/

| File | Section |
|------|---------|
| `webui/index.html` | Â§14 |
| `webui/index.js` | Â§14 |
| `webui/index.css` | Â§14 |
| `webui/login.html` | Â§14 |
| `webui/login.css` | Â§14 |
| `webui/components/*` | Â§14 |
| `webui/css/*` | Â§14 |
| `webui/js/*` | Â§14 |
| `webui/public/*` | Â§14 |
| `webui/vendor/*` | Â§14 |

### Build & Environment

| File | Section |
|------|---------|
| `.gitignore` | Â§19 |
| `.dockerignore` | Â§19 |
| `.gitattributes` | Â§19 |

---

*Analysis generated from full repository inspection. Every file listed above directly participates in the build, configuration, deployment, or runtime execution of Agent Zero.*
